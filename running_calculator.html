<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruang Lari Tools</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background: linear-gradient(135deg, var(--gray-50) 0%, #fdf2f8 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            font-size: 1.125rem;
            color: var(--gray-600);
            font-weight: 400;
        }
        
        .global-controls {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
        }
        
        .unit-selector {
            background: var(--white);
            padding: 1rem 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
        }
        
        .unit-selector select {
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--white);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .unit-selector select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgb(99 102 241 / 0.1);
        }
        
        /* Tab Navigation */
        .tab-navigation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-bottom: 2rem;
            background: var(--white);
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--gray-200);
        }
        
        .tab-btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            background: transparent;
            color: var(--gray-600);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            text-align: center;
        }
        
        .tab-btn:hover {
            background: var(--gray-100);
            color: var(--gray-800);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            background: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            margin-bottom: 2rem;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .info-note {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary);
            font-size: 0.875rem;
            color: var(--gray-700);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray-700);
            font-size: 0.875rem;
        }
        
        input, select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 400;
            transition: all 0.2s ease;
            background: var(--white);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgb(99 102 241 / 0.1);
        }
        
        input:disabled {
            background-color: var(--gray-100);
            color: var(--gray-500);
            cursor: not-allowed;
        }
        
        .time-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }
        
        .time-inputs input {
            text-align: center;
            font-weight: 500;
        }
        #globalUnit{
            padding-top:5px !important;
        }
        button {
            width: 100%;
            padding: 1rem 2rem;
            
            color: var(--white);
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .results {
            margin-top: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--gray-50) 0%, #fdf2f8 100%);
            border-radius: 1rem;
            display: none;
            border: 1px solid var(--gray-200);
        }
        
        .results.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-grid {
            display: grid;
            gap: 1rem;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--white);
            border-radius: 0.75rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
        }
        
        .result-label {
            font-weight: 500;
            color: var(--gray-700);
            font-size: 0.875rem;
        }
        
        .result-value {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.125rem;
        }
        
        .error {
            color: var(--error);
            background: #fef2f2;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            border-left: 4px solid var(--error);
            font-size: 0.875rem;
        }
        
        .split-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .split-item {
            background: var(--white);
            padding: 1.25rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--accent);
            border: 1px solid var(--gray-200);
        }
        
        .split-item strong {
            display: block;
            color: var(--primary);
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
        }
        
        .vo2-category {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .vo2-excellent { background: #d1fae5; color: #065f46; }
        .vo2-good { background: #dbeafe; color: #1e40af; }
        .vo2-fair { background: #fef3c7; color: #92400e; }
        .vo2-poor { background: #fee2e2; color: #991b1b; }
        
        /* Heart Rate Zone Styles */
        .hr-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: var(--white);
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }
        
        .hr-table th,
        .hr-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .hr-table th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .hr-table tr:hover {
            background: var(--gray-50);
        }
        
        /* Mobile responsive table - stackable */
        @media (max-width: 768px) {
            .hr-table,
            .hr-table thead,
            .hr-table tbody,
            .hr-table th,
            .hr-table td,
            .hr-table tr {
                display: block;
            }
            
            .hr-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            .hr-table tr {
                border: 1px solid var(--gray-200);
                margin-bottom: 1rem;
                border-radius: 0.75rem;
                background: var(--white);
                box-shadow: var(--shadow-sm);
                padding: 0.75rem;
            }
            
            .hr-table td {
                border: none;
                position: relative;
                padding: 0.75rem 0 0.75rem 40%;
                text-align: left;
                border-bottom: 1px solid var(--gray-100);
            }
            
            .hr-table td:before {
                content: attr(data-label);
                position: absolute;
                left: 6px;
                width: 35%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: 600;
                color: var(--primary);
                font-size: 0.875rem;
            }
            
            .hr-table td:last-child {
                border-bottom: none;
            }
        }
        
        .hr-zone {
            font-weight: 600;
            color: var(--primary);
        }
        
        .hr-range {
            font-family: 'Courier New', monospace;
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .hr-percentage {
            color: var(--gray-600);
            font-size: 0.875rem;
        }
        
        .hr-description {
            color: var(--gray-600);
            font-size: 0.875rem;
            line-height: 1.4;
        }
        
        .export-button {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .export-button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }
        
        .export-container {
            background: white;
            padding: 2rem;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            position: relative;
        }
        
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: auto;
            opacity: 0.5;
            pointer-events: none;
            z-index: 10;
        }
        
        .hr-summary {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;            
        }
        
        .hr-summary h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.125rem;
        }
        
        .hr-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .hr-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }
        
        .hr-summary-label {
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .hr-summary-value {
            font-weight: 600;
            color: var(--primary);
        }
        
        /* Slider Styles */
        .slider-container {
            position: relative;
            margin-top: 0.5rem;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--gray-200);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            cursor: pointer;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.2s ease;
        }
        
        .slider::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }
        
        .slider-value {
            position: absolute;
            top: -30px;
            right: 0;
            background: var(--primary);
            color: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }
        
        .slider-value::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .header {
                margin-bottom: 1.5rem;
            }
            
            .header h1 {
                font-size: 1.75rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .global-controls {
                margin-bottom: 1.5rem;
            }
            
            .unit-selector {
                padding: 0.75rem 1rem;
            }
            
            .tab-navigation {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 0.25rem;
                padding: 0.75rem;
            }
            
            .tab-btn {
                padding: 0.5rem 0.25rem;
                font-size: 0.65rem;
                text-align: center;
            }
            
            .tab-content {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .form-group {
                margin-bottom: 1rem;
            }
            
            .time-inputs {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .results {
                padding: 1rem;
                margin-top: 1rem;
            }
            
            .result-item {
                padding: 0.75rem;
                margin-bottom: 0.5rem;
            }
            
            .result-label {
                font-size: 0.8rem;
            }
            
            .result-value {
                font-size: 1rem;
            }
            
            .split-results {
                grid-template-columns: 1fr;
                gap: 0.75rem;
                margin-top: 1rem;
            }
            
            .split-item {
                padding: 1rem;
            }
            
            .hr-summary {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .hr-summary h3 {
                font-size: 1rem;
                margin-bottom: 0.75rem;
            }
            
            .hr-summary-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .hr-summary-item {
                padding: 0.25rem 0;
            }
            
            .hr-summary-label {
                font-size: 0.8rem;
            }
            
            .hr-summary-value {
                font-size: 0.9rem;
            }
            
            .export-button {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
                margin-top: 0.75rem;
            }
        }
        
        /* Extra small mobile devices */
        @media (max-width: 480px) {
            .container {
                padding: 0.25rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .tab-navigation {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.2rem;
                padding: 0.5rem;
            }
            
            .tab-btn {
                padding: 0.4rem 0.2rem;
                font-size: 0.6rem;
                text-align: center;
            }
            
            .tab-content {
                padding: 0.75rem;
            }
            
            .form-group {
                margin-bottom: 0.75rem;
            }
            
            .results {
                padding: 0.75rem;
            }
            
            .result-item {
                padding: 0.5rem;
            }
            
            .result-label {
                font-size: 0.75rem;
            }
            
            .result-value {
                font-size: 0.9rem;
            }
            
            .hr-summary {
                padding: 0.75rem;
            }
            
            .hr-summary h3 {
                font-size: 0.9rem;
            }
            
            .hr-summary-label {
                font-size: 0.75rem;
            }
            
            .hr-summary-value {
                font-size: 0.8rem;
            }
            
            .export-button {
                padding: 0.4rem 0.75rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ruang Lari Tools Calculator</h1>
            <p>Calculator Lari Khusus Untuk Para Pelari</p>
        </div>
        
        <div class="global-controls">
            <div class="unit-selector">
                <label for="globalUnit"><strong>Unit System:</strong></label>
                <select id="globalUnit" onchange="updateGlobalUnit()">
                    <option value="metric">Metric (km, min/km, km/h)</option>
                    <option value="imperial">Imperial (miles, min/mile, mph)</option>
                </select>
            </div>
        </div>
        
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="openTab(event, 'magicMile')">üéØ Magic Mile</button>
            <button class="tab-btn" onclick="openTab(event, 'marathon')">üèÉ‚Äç‚ôÄÔ∏è Marathon Pace</button>
            <button class="tab-btn" onclick="openTab(event, 'pace')">‚è±Ô∏è Pace Calculator</button>
            <button class="tab-btn" onclick="openTab(event, 'predictor')">üîÆ Race Predictor</button>
            <button class="tab-btn" onclick="openTab(event, 'improvement')">üìà Improvement</button>
            <button class="tab-btn" onclick="openTab(event, 'splits')">üìä Splits</button>
            <button class="tab-btn" onclick="openTab(event, 'steps')">üë£ Steps to Distance</button>
            <button class="tab-btn" onclick="openTab(event, 'stride')">üìè Stride Length</button>
            <button class="tab-btn" onclick="openTab(event, 'training')">üéØ Training Pace</button>
            <button class="tab-btn" onclick="openTab(event, 'vo2max')">üí® VO2 Max</button>
            <button class="tab-btn" onclick="openTab(event, 'heartrate')">‚ù§Ô∏è Heart Rate Zone</button>
        </div>
        
        <!-- VO2 Max Calculator -->
        <div id="vo2max" class="tab-content" data-hash="vo2max">
            <div class="info-note">
                Estimasi VO2 Max berdasarkan performa race menggunakan formula Jack Daniels yang telah terbukti akurat untuk runners.
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label id="vo2DistanceLabel">Race Distance (km):</label>
                    <input type="number" id="vo2Distance" step="0.1" min="0.1" placeholder="e.g., 5">
                </div>
            </div>
            <div class="form-group">
                <label>Race Time:</label>
                <div class="time-inputs">
                    <input type="number" id="vo2Hours" placeholder="Hours" min="0">
                    <input type="number" id="vo2Minutes" placeholder="Min" min="0">
                    <input type="number" id="vo2Seconds" placeholder="Sec" min="0">
                </div>
            </div>
            <button onclick="calculateVO2Max()">Calculate VO2 Max</button>
            <div id="vo2Error" class="error" style="display: none;"></div>
            <div id="vo2Results" class="results"></div>
            <button class="export-button" onclick="exportResults('vo2Results', 'VO2 Max Calculator')" style="display: none;" id="vo2ExportBtn">
                üì∏ Ekspor Hasil ke Image
            </button>
        </div>

        <!-- Magic Mile Calculator -->
        <div id="magicMile" class="tab-content active" data-hash="magicmile">
            <div class="info-note">
                Prediksi waktu race berdasarkan waktu lari 1 mile. Magic Mile adalah tes yang akurat untuk menentukan pace training dan race target.
            </div>
            <div class="form-group">
                <label>Magic Mile Time:</label>
                <div class="time-inputs">
                    <input type="number" id="magicHours" placeholder="Hours" min="0">
                    <input type="number" id="magicMinutes" placeholder="Min" min="0">
                    <input type="number" id="magicSeconds" placeholder="Sec" min="0" max="59">
                </div>
            </div>
            <button onclick="calculateMagicMile()">Calculate Race Predictions</button>
            <div id="magicMileError" class="error" style="display: none;"></div>
            <div id="magicMileResults" class="results"></div>
            <button class="export-button" onclick="exportResults('magicMileResults', 'Magic Mile Calculator')" style="display: none;" id="magicMileExportBtn">
                üì∏ Ekspor Hasil ke Image
            </button>
        </div>

        <!-- Marathon Pace Calculator -->
        <div id="marathon" class="tab-content" data-hash="marathon">
            <div class="info-note">
                Hitung pace yang dibutuhkan untuk mencapai target waktu marathon (42.195 km / 26.2 miles).
            </div>
            <div class="form-group">
                <label>Target Marathon Time:</label>
                <div class="time-inputs">
                    <input type="number" id="marathonHours" placeholder="Hours" min="0">
                    <input type="number" id="marathonMinutes" placeholder="Min" min="0" max="59">
                    <input type="number" id="marathonSeconds" placeholder="Sec" min="0" max="59">
                </div>
            </div>
            <button onclick="calculateMarathonPace()">Calculate Marathon Pace</button>
            <div id="marathonError" class="error" style="display: none;"></div>
            <div id="marathonResults" class="results"></div>
            <button class="export-button" onclick="exportResults('marathonResults', 'Marathon Pace Calculator')" style="display: none;" id="marathonExportBtn">
                üì∏ Ekspor Hasil ke Image
            </button>
        </div>

        <!-- Pace Calculator -->
        <div id="pace" class="tab-content" data-hash="pacecalculator">
            <div class="info-note">
                Hitung pace berdasarkan jarak dan waktu lari Anda.
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Unit Jarak:</label>
                    <select id="paceUnit" onchange="updatePaceDistanceLabel()">
                        <option value="meter">Meter (m)</option>
                        <option value="km">Kilometer (km)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label id="paceDistanceLabel">Distance (m):</label>
                    <input type="number" id="paceDistance" step="0.1" min="0.1" placeholder="e.g., 5000">
                </div>
            </div>
            <div class="form-group">
                <label>Time:</label>
                <div class="time-inputs">
                    <input type="number" id="paceHours" placeholder="Hours" min="0">
                    <input type="number" id="paceMinutes" placeholder="Min" min="0">
                    <input type="number" id="paceSeconds" placeholder="Sec" min="0">
                </div>
            </div>
            <button onclick="calculatePace()">Calculate Pace</button>
            <div id="paceError" class="error" style="display: none;"></div>
            <div id="paceResults" class="results"></div>
            <button class="export-button" onclick="exportResults('paceResults', 'Pace Calculator')" style="display: none;" id="paceExportBtn">
                üì∏ Ekspor Hasil ke Image
            </button>
        </div>

        <!-- Race Predictor -->
        <div id="predictor" class="tab-content" data-hash="racepredictor">
            <div class="info-note">
                Prediksi waktu race berdasarkan performa race sebelumnya menggunakan Riegel's Formula.
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label id="recentRaceDistanceLabel">Recent Race Distance (km):</label>
                    <select id="recentRaceDistanceSelect" onchange="updateRecentRaceDistance()">
                        <option value="custom">Custom Distance</option>
                        <option value="5">5K (5 km)</option>
                        <option value="10">10K (10 km)</option>
                        <option value="21.1">Half Marathon (21.1 km)</option>
                        <option value="42.2">Marathon (42.2 km)</option>
                    </select>
                    <input type="number" id="recentRaceDistance" step="0.1" min="0.1" placeholder="e.g., 10" style="margin-top: 0.5rem;">
                </div>
                <div class="form-group">
                    <label id="targetRaceDistanceLabel">Target Race Distance (km):</label>
                    <select id="targetRaceDistanceSelect" onchange="updateTargetRaceDistance()">
                        <option value="custom">Custom Distance</option>
                        <option value="5">5K (5 km)</option>
                        <option value="10">10K (10 km)</option>
                        <option value="21.1">Half Marathon (21.1 km)</option>
                        <option value="42.2">Marathon (42.2 km)</option>
                    </select>
                    <input type="number" id="targetRaceDistance" step="0.1" min="0.1" placeholder="e.g., 21.1" style="margin-top: 0.5rem;">
                </div>
            </div>
            <div class="form-group">
                <label>Recent Race Time:</label>
                <div class="time-inputs">
                    <input type="number" id="recentRaceHours" placeholder="Hours" min="0">
                    <input type="number" id="recentRaceMinutes" placeholder="Min" min="0">
                    <input type="number" id="recentRaceSeconds" placeholder="Sec" min="0">
                </div>
            </div>
            <button onclick="calculateRacePredictor()">Predict Race Time</button>
            <div id="racePredictorError" class="error" style="display: none;"></div>
            <div id="racePredictorResults" class="results"></div>
            <button class="export-button" onclick="exportResults('racePredictorResults', 'Race Predictor Calculator')" style="display: none;" id="racePredictorExportBtn">
                üì∏ Ekspor Hasil ke Image
            </button>
        </div>

        <!-- Race Time Improvement Calculator -->
        <div id="improvement" class="tab-content" data-hash="improvement">
            <div class="info-note">
                Hitung berapa banyak improvement yang dibutuhkan untuk mencapai target waktu race.
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label id="improvementDistanceLabel">Race Distance (km):</label>
                    <input type="number" id="improvementDistance" step="0.1" min="0.1" placeholder="e.g., 10">
                </div>
            </div>
            <div class="form-group">
                <label>Current Best Time:</label>
                <div class="time-inputs">
                    <input type="number" id="currentBestHours" placeholder="Hours" min="0">
                    <input type="number" id="currentBestMinutes" placeholder="Min" min="0">
                    <input type="number" id="currentBestSeconds" placeholder="Sec" min="0">
                </div>
            </div>
            <div class="form-group">
                <label>Target Time:</label>
                <div class="time-inputs">
                    <input type="number" id="targetTimeHours" placeholder="Hours" min="0">
                    <input type="number" id="targetTimeMinutes" placeholder="Min" min="0">
                    <input type="number" id="targetTimeSeconds" placeholder="Sec" min="0">
                </div>
            </div>
            <button onclick="calculateImprovement()">Calculate Improvement</button>
            <div id="improvementError" class="error" style="display: none;"></div>
            <div id="improvementResults" class="results"></div>
            <button class="export-button" onclick="exportResults('improvementResults', 'Race Improvement Calculator')" style="display: none;" id="improvementExportBtn">
                üì∏ Ekspor Hasil ke Image
            </button>
        </div>

        <!-- Running Split Calculator -->
        <div id="splits" class="tab-content" data-hash="splits">
            <div class="info-note">
                Hitung split times untuk race dengan pace yang konsisten. Gunakan slider untuk mengatur negative/positive splits.
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label id="splitDistanceLabel">Total Distance (km):</label>
                    <select id="splitDistanceSelect" onchange="updateSplitDistance()">
                        <option value="custom">Custom Distance</option>
                        <option value="5">5K (5 km)</option>
                        <option value="10">10K (10 km)</option>
                        <option value="21.1">Half Marathon (21.1 km)</option>
                        <option value="42.2">Marathon (42.2 km)</option>
                    </select>
                    <input type="number" id="splitDistance" step="0.1" min="0.1" placeholder="e.g., 21.1" style="margin-top: 0.5rem;">
                </div>
                <div class="form-group">
                    <label id="splitIntervalLabel">Split Interval (km):</label>
                    <input type="number" id="splitInterval" step="0.1" min="0.1" placeholder="e.g., 1" value="1">
                </div>
            </div>
            <div class="form-group">
                <label>Target Total Time:</label>
                <div class="time-inputs">
                    <input type="number" id="splitHours" placeholder="Hours" min="0">
                    <input type="number" id="splitMinutes" placeholder="Min" min="0">
                    <input type="number" id="splitSeconds" placeholder="Sec" min="0">
                </div>
            </div>
            <div class="form-group">
                <label>Split Strategy:</label>
                <div class="form-row">
                    <div class="form-group">
                        <label for="splitStrategy">Strategy Type:</label>
                        <select id="splitStrategy" onchange="updateSplitStrategy()">
                            <option value="even">Even Splits (Konsisten)</option>
                            <option value="negative">Negative Splits (Perlahan ke Cepat)</option>
                            <option value="positive">Positive Splits (Cepat ke Perlahan)</option>
                        </select>
                    </div>
                    <div class="form-group" id="splitPercentageGroup" style="display: none;">
                        <label for="splitPercentage">Pace Change per Split (%):</label>
                        <div class="slider-container">
                            <input type="range" id="splitPercentage" min="0" max="10" step="0.1" value="2" 
                                   oninput="updateSplitPercentageValue()" class="slider">
                            <div class="slider-value" id="splitPercentageValue">2.0%</div>
                        </div>
                    </div>
                </div>
            </div>
            <button onclick="calculateSplits()">Calculate Splits</button>
            <div id="splitError" class="error" style="display: none;"></div>
            <div id="splitResults" class="results"></div>
            <button class="export-button" onclick="exportResults('splitResults', 'Running Splits Calculator')" style="display: none;" id="splitExportBtn">
                üì∏ Ekspor Hasil ke Image
            </button>
        </div>

        <!-- Steps to Distance Calculator -->
        <div id="steps" class="tab-content" data-hash="steps">
            <div class="info-note">
                Konversi jumlah langkah ke jarak berdasarkan stride length Anda.
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Number of Steps:</label>
                    <input type="number" id="stepsCount" min="1" placeholder="e.g., 10000">
                </div>
                <div class="form-group">
                    <label id="strideLengthLabel">Stride Length (cm):</label>
                    <input type="number" id="strideLength" step="0.1" min="1" placeholder="e.g., 75" value="75">
                </div>
            </div>
            <button onclick="calculateStepsToDistance()">Calculate Distance</button>
            <div id="stepsError" class="error" style="display: none;"></div>
            <div id="stepsResults" class="results"></div>
            <button class="export-button" onclick="exportResults('stepsResults', 'Steps to Distance Calculator')" style="display: none;" id="stepsExportBtn">
                üì∏ Ekspor Hasil ke Image
            </button>
        </div>

        <!-- Stride Length Calculator -->
        <div id="stride" class="tab-content" data-hash="stride">
            <div class="info-note">
                Hitung stride length berdasarkan jarak yang ditempuh dan jumlah langkah.
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label id="strideDistanceLabel">Distance Covered (km):</label>
                    <input type="number" id="strideDistance" step="0.01" min="0.01" placeholder="e.g., 1">
                </div>
                <div class="form-group">
                    <label>Number of Steps:</label>
                    <input type="number" id="strideStepsCount" min="1" placeholder="e.g., 1333">
                </div>
            </div>
            <button onclick="calculateStrideLength()">Calculate Stride Length</button>
            <div id="strideLengthError" class="error" style="display: none;"></div>
            <div id="strideLengthResults" class="results"></div>
            <button class="export-button" onclick="exportResults('strideLengthResults', 'Stride Length Calculator')" style="display: none;" id="strideLengthExportBtn">
                üì∏ Ekspor Hasil ke Image
            </button>
        </div>

		<!-- Training Pace Calculator -->
		<div id="training" class="tab-content" data-hash="training">
			<div class="info-note">
				Hitung berbagai pace training berdasarkan best race time atau threshold pace. Masukkan best time untuk auto-compute base pace.
			</div>
			<div class="form-row">
				<div class="form-group">
					<label>Base Pace Type:</label>
					<select id="basePaceType" onchange="setDefaultDistance()">
						<option value="5k">5K Race Pace</option>
						<option value="10k">10K Race Pace</option>
						<option value="half">Half Marathon Pace</option>
						<option value="marathon">Marathon Pace</option>
						<option value="threshold">Threshold Pace</option>
					</select>
				</div>
			</div>
			<div class="form-row">
				<div class="form-group">
					<label id="trainingDistanceLabel">Best Race Distance (km):</label>
					<input type="number" id="trainingDistance" step="0.1" min="0.1" placeholder="e.g., 5" value="5">
				</div>
			</div>
			<div class="form-group">
				<label>Best Race Time (optional, for auto-compute):</label>
				<div class="time-inputs">
					<input type="number" id="bestTimeHours" placeholder="Hours" min="0">
					<input type="number" id="bestTimeMinutes" placeholder="Min" min="0">
					<input type="number" id="bestTimeSeconds" placeholder="Sec" min="0">
				</div>
			</div>
			<div class="form-group">
				<label>Manual Base Pace (per <span id="basePaceUnit">km</span>, fallback):</label>
				<div class="time-inputs">
					<input type="number" id="basePaceHours" placeholder="Hours" min="0">
					<input type="number" id="basePaceMinutes" placeholder="Min" min="0">
					<input type="number" id="basePaceSeconds" placeholder="Sec" min="0" max="59">
				</div>
			</div>
		<button onclick="calculateTrainingPaces()">Calculate Training Paces</button>
		<div id="trainingPaceError" class="error" style="display: none;"></div>
		<div id="trainingPaceResults" class="results"></div>
		<button class="export-button" onclick="exportResults('trainingPaceResults', 'Training Pace Calculator')" style="display: none;" id="trainingPaceExportBtn">
			üì∏ Ekspor Hasil ke Image
		</button>
		</div>

        <!-- Heart Rate Zone Calculator -->
        <div id="heartrate" class="tab-content" data-hash="heartrate">
            <div class="info-note">
                Hitung zona detak jantung optimal untuk latihan berdasarkan usia, detak jantung istirahat, dan faktor lainnya menggunakan formula Karvonen.
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Usia (tahun) *:</label>
                    <input type="number" id="hrAge" min="10" max="100" placeholder="e.g., 30" required>
                </div>
                <div class="form-group">
                    <label>Detak Jantung Istirahat (HRrest):</label>
                    <input type="number" id="hrRest" min="30" max="120" placeholder="e.g., 60 (opsional)">
                    <small style="color: var(--gray-500); font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                        Kosongkan jika tidak tahu, akan diestimasi otomatis
                    </small>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Jenis Kelamin:</label>
                    <select id="hrGender">
                        <option value="male">Laki-laki</option>
                        <option value="female">Perempuan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tingkat Kebugaran:</label>
                    <select id="hrFitness">
                        <option value="beginner">Pemula</option>
                        <option value="intermediate">Menengah</option>
                        <option value="advanced">Lanjutan</option>
                        <option value="athlete">Atlet</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Intensitas Latihan:</label>
                    <select id="hrIntensity">
                        <option value="recovery">Recovery (Pemulihan)</option>
                        <option value="easy">Easy (Mudah)</option>
                        <option value="moderate">Moderate (Sedang)</option>
                        <option value="tempo">Tempo (Threshold)</option>
                        <option value="interval">Interval (VO2 Max)</option>
                        <option value="repetition">Repetition (Kecepatan)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Durasi Latihan (menit):</label>
                    <input type="number" id="hrDuration" min="5" max="300" placeholder="e.g., 30" value="30">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <button type="button" id="getWeatherBtn" onclick="getCurrentWeather()" style="width: 100%; padding: 0.75rem 1rem; background: var(--accent); color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; margin-bottom: 0.5rem;">
                        üå°Ô∏è Deteksi Cuaca Otomatis
                    </button>
                    <label>Suhu Lingkungan (¬∞C):</label>
                    <input type="number" id="hrTemperature" min="0" max="50" placeholder="e.g., 25" value="25">
                    <small style="color: var(--gray-500); font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                        Klik tombol di atas untuk deteksi otomatis
                    </small>
                </div>
                <div class="form-group">
                    <label>Kelembaban (%):</label>
                    <input type="number" id="hrHumidity" min="0" max="100" placeholder="e.g., 60" value="60">
                </div>
            </div>
            <button onclick="calculateHeartRateZones()">Hitung Zona Heart Rate</button>
            <div id="heartRateError" class="error" style="display: none;"></div>
            <div id="heartRateResults" class="results"></div>
        </div>

    </div>

    <script>
        let globalUnit = 'metric';
        
        function updateGlobalUnit() {
            globalUnit = document.getElementById('globalUnit').value;
            updateAllLabels();
        }
        
        function updateAllLabels() {
            const isMetric = globalUnit === 'metric';
            const distanceUnit = isMetric ? 'km' : 'miles';
            
            // Update all distance labels
            const distanceLabels = [
				'paceDistanceLabel', 'recentRaceDistanceLabel', 'targetRaceDistanceLabel',
				'improvementDistanceLabel', 'splitDistanceLabel', 'splitIntervalLabel',
				'strideDistanceLabel', 'vo2DistanceLabel', 'trainingDistanceLabel'  // Add this
			];
            
            distanceLabels.forEach(labelId => {
				const element = document.getElementById(labelId);
				if (element) {
					element.textContent = element.textContent.replace(/(km|miles)/, distanceUnit);
				}
			});
            
            // Update stride length label
            const strideLengthLabel = document.getElementById('strideLengthLabel');
            if (strideLengthLabel) {
                strideLengthLabel.textContent = isMetric ? 'Stride Length (cm):' : 'Stride Length (inches):';
            }
            
            // Update base pace unit
            const basePaceUnit = document.getElementById('basePaceUnit');
            if (basePaceUnit) {
                basePaceUnit.textContent = distanceUnit;
            }
        }
        
        function openTab(evt, tabName) {
            var i, tabContent, tabBtns;
            
            // Hide all tab contents
            tabContent = document.getElementsByClassName('tab-content');
            for (i = 0; i < tabContent.length; i++) {
                tabContent[i].classList.remove('active');
            }
            
            // Remove active class from all tab buttons
            tabBtns = document.getElementsByClassName('tab-btn');
            for (i = 0; i < tabBtns.length; i++) {
                tabBtns[i].classList.remove('active');
            }
            
            // Show the selected tab content and mark button as active
            const tabElement = document.getElementById(tabName);
            tabElement.classList.add('active');
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add('active');
            }
            
            // Update URL hash
            const hash = tabElement.getAttribute('data-hash');
            if (hash) {
                window.location.hash = hash;
            }
            
            // Scroll to the tab content with smooth behavior
            setTimeout(() => {
                tabElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 100);
        }
        
        // Function to open tab by hash
        function openTabByHash(hash) {
            if (!hash) return;
            
            // Find tab with matching hash
            const tabContent = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContent.length; i++) {
                const tabHash = tabContent[i].getAttribute('data-hash');
                if (tabHash === hash) {
                    const tabName = tabContent[i].id;
                    
                    // Hide all tabs
                    for (let j = 0; j < tabContent.length; j++) {
                        tabContent[j].classList.remove('active');
                    }
                    
                    // Remove active from all buttons
                    const tabBtns = document.getElementsByClassName('tab-btn');
                    for (let j = 0; j < tabBtns.length; j++) {
                        tabBtns[j].classList.remove('active');
                    }
                    
                    // Show selected tab
                    tabContent[i].classList.add('active');
                    
                    // Activate corresponding button
                    const tabBtns2 = document.getElementsByClassName('tab-btn');
                    for (let j = 0; j < tabBtns2.length; j++) {
                        if (tabBtns2[j].getAttribute('onclick') && tabBtns2[j].getAttribute('onclick').includes(tabName)) {
                            tabBtns2[j].classList.add('active');
                            break;
                        }
                    }
                    
                    // Scroll to tab
                    setTimeout(() => {
                        tabContent[i].scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }, 100);
                    
                    break;
                }
            }
        }
        
        function convertDistanceToMetric(distance) {
            return globalUnit === 'imperial' ? distance * 1.60934 : distance;
        }
        
        function convertDistanceFromMetric(distance) {
            return globalUnit === 'imperial' ? distance / 1.60934 : distance;
        }
        
        function formatTime(totalSeconds, includeHours = true) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);
            
            if (includeHours && hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        function timeToSeconds(hours, minutes, seconds) {
            return (hours || 0) * 3600 + (minutes || 0) * 60 + (seconds || 0);
        }
        
        function showError(errorId, message) {
            const errorElement = document.getElementById(errorId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            document.getElementById(errorId.replace('Error', 'Results')).classList.remove('show');
        }
        
        function showResults(resultsId, results) {
            document.getElementById(resultsId.replace('Results', 'Error')).style.display = 'none';
            const resultsElement = document.getElementById(resultsId);
            resultsElement.innerHTML = results;
            resultsElement.classList.add('show');
            
            // Show export button
            const exportBtnId = resultsId.replace('Results', 'ExportBtn');
            const exportBtn = document.getElementById(exportBtnId);
            if (exportBtn) {
                exportBtn.style.display = 'inline-flex';
            }
            
            // Scroll to results with smooth behavior
            setTimeout(() => {
                resultsElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 200);
        }
        
        // VO2 Max Calculator - Fixed Formula
        function calculateVO2Max() {
            const distance = parseFloat(document.getElementById('vo2Distance').value);
            const hours = parseInt(document.getElementById('vo2Hours').value) || 0;
            const minutes = parseInt(document.getElementById('vo2Minutes').value) || 0;
            const seconds = parseInt(document.getElementById('vo2Seconds').value) || 0;
            
            if (!distance) {
                showError('vo2Error', 'Please enter a valid distance.');
                return;
            }
            
            const totalSeconds = timeToSeconds(hours, minutes, seconds);
            if (totalSeconds === 0) {
                showError('vo2Error', 'Please enter a valid time.');
                return;
            }
            
            const distanceMetric = convertDistanceToMetric(distance);
            
            // Jack Daniels' VO2 Max formula (more accurate)
            // VO2 = -4.6 + 0.182258 * (velocity in m/min) + 0.000104 * (velocity in m/min)^2
            const velocityMPerMin = (distanceMetric * 1000) / (totalSeconds / 60); // meters per minute
            const vo2Max = -4.6 + 0.182258 * velocityMPerMin + 0.000104 * Math.pow(velocityMPerMin, 2);
            
            // Alternative formula for verification (Daniels & Gilbert)
            const velocityMPerSec = (distanceMetric * 1000) / totalSeconds;
            const vo2MaxAlt = 15.3 * velocityMPerSec; // Alternative calculation
            
            // Use the more conservative estimate
            const finalVO2Max = Math.min(vo2Max, vo2MaxAlt);
            
            const distanceUnit = globalUnit === 'metric' ? 'km' : 'miles';
            const pace = totalSeconds / distanceMetric;
            const adjustedPace = globalUnit === 'metric' ? pace : pace * 1.60934;
            const paceUnit = globalUnit === 'metric' ? 'min/km' : 'min/mile';
            
            // Updated VO2 Max categories (age/gender neutral)
            let category = '';
            let categoryClass = '';
            if (finalVO2Max >= 55) {
                category = 'Excellent';
                categoryClass = 'vo2-excellent';
            } else if (finalVO2Max >= 45) {
                category = 'Good';
                categoryClass = 'vo2-good';
            } else if (finalVO2Max >= 35) {
                category = 'Fair';
                categoryClass = 'vo2-fair';
            } else {
                category = 'Poor';
                categoryClass = 'vo2-poor';
            }
            
            // Training zones based on VO2 Max
            const easyPace = pace * 1.2;
            const tempoPace = pace * 0.88;
            const intervalPace = pace * 0.95;
            
            let results = `
                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">Distance</div>
                        <div class="result-value">${distance} ${distanceUnit}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Race Time</div>
                        <div class="result-value">${formatTime(totalSeconds, true)}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Race Pace</div>
                        <div class="result-value">${formatTime(adjustedPace, false)} ${paceUnit}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Estimated VO2 Max</div>
                        <div class="result-value">${finalVO2Max.toFixed(1)} ml/kg/min</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Fitness Level</div>
                        <div class="result-value"><span class="vo2-category ${categoryClass}">${category}</span></div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Easy Pace</div>
                        <div class="result-value">${formatTime(adjustedPace * 1.2, false)} ${paceUnit}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Tempo Pace</div>
                        <div class="result-value">${formatTime(adjustedPace * 0.88, false)} ${paceUnit}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Interval Pace</div>
                        <div class="result-value">${formatTime(adjustedPace * 0.95, false)} ${paceUnit}</div>
                    </div>
                </div>
            `;
            
            showResults('vo2Results', results);
        }
        
        // Magic Mile Calculator
        function calculateMagicMile() {
            const hours = parseInt(document.getElementById('magicHours').value) || 0;
            const minutes = parseInt(document.getElementById('magicMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('magicSeconds').value) || 0;
            
            const magicMileSeconds = timeToSeconds(hours, minutes, seconds);
            if (magicMileSeconds === 0) {
                showError('magicMileError', 'Please enter a valid magic mile time.');
                return;
            }
            
            const distanceUnit = globalUnit === 'metric' ? 'km' : 'miles';
            
            // Magic Mile predictions based on Jack Daniels' formulas
            const mileToKm = 1.60934;
            const basePace = magicMileSeconds / (globalUnit === 'metric' ? mileToKm : 1);
            
            const predictions = {
                '5K': basePace * (globalUnit === 'metric' ? 5 : 3.1) * 1.05,
                '10K': basePace * (globalUnit === 'metric' ? 10 : 6.2) * 1.08,
                'Half Marathon': basePace * (globalUnit === 'metric' ? 21.1 : 13.1) * 1.15,
                'Marathon': basePace * (globalUnit === 'metric' ? 42.2 : 26.2) * 1.2
            };
            
            let results = '<div class="result-grid">';
            results += `<div class="result-item"><div class="result-label">Magic Mile Time</div><div class="result-value">${formatTime(magicMileSeconds, true)}</div></div>`;
            
            Object.entries(predictions).forEach(([race, time]) => {
                results += `<div class="result-item"><div class="result-label">${race} Prediction</div><div class="result-value">${formatTime(time, true)}</div></div>`;
            });
            
            results += '</div>';
            showResults('magicMileResults', results);
        }
        
        // Marathon Pace Calculator
        function calculateMarathonPace() {
            const hours = parseInt(document.getElementById('marathonHours').value) || 0;
            const minutes = parseInt(document.getElementById('marathonMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('marathonSeconds').value) || 0;
            
            const totalSeconds = timeToSeconds(hours, minutes, seconds);
            if (totalSeconds === 0) {
                showError('marathonError', 'Please enter a valid marathon time.');
                return;
            }
            
            const marathonDistance = globalUnit === 'metric' ? 42.195 : 26.2;
            const pacePerUnit = totalSeconds / marathonDistance;
            const speed = (marathonDistance / (totalSeconds / 3600)).toFixed(2);
            
            const paceUnit = globalUnit === 'metric' ? 'min/km' : 'min/mile';
            const speedUnit = globalUnit === 'metric' ? 'km/h' : 'mph';
            
            let results = `
                <div class="result-grid">
                    <div class="result-item"><div class="result-label">Target Marathon Time</div><div class="result-value">${formatTime(totalSeconds, true)}</div></div>
                    <div class="result-item"><div class="result-label">Required Pace</div><div class="result-value">${formatTime(pacePerUnit, false)} ${paceUnit}</div></div>
                    <div class="result-item"><div class="result-label">Average Speed</div><div class="result-value">${speed} ${speedUnit}</div></div>
                </div>
            `;
            
            showResults('marathonResults', results);
        }
        
        // Update Pace Distance Label
        function updatePaceDistanceLabel() {
            const paceUnit = document.getElementById('paceUnit').value;
            const label = document.getElementById('paceDistanceLabel');
            const input = document.getElementById('paceDistance');
            
            if (paceUnit === 'meter') {
                label.textContent = 'Distance (m):';
                input.placeholder = 'e.g., 5000';
                input.step = '1';
            } else {
                label.textContent = 'Distance (km):';
                input.placeholder = 'e.g., 5';
                input.step = '0.1';
            }
        }
        
        // Pace Calculator
        function calculatePace() {
            const distance = parseFloat(document.getElementById('paceDistance').value);
            const paceUnitInput = document.getElementById('paceUnit').value;
            const hours = parseInt(document.getElementById('paceHours').value) || 0;
            const minutes = parseInt(document.getElementById('paceMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('paceSeconds').value) || 0;
            
            if (!distance || distance <= 0) {
                showError('paceError', 'Please enter a valid distance.');
                return;
            }
            
            const totalSeconds = timeToSeconds(hours, minutes, seconds);
            if (totalSeconds === 0) {
                showError('paceError', 'Please enter a valid time.');
                return;
            }
            
            // Convert distance to kilometers
            let distanceInKm;
            if (paceUnitInput === 'meter') {
                distanceInKm = distance / 1000; // Convert meters to km
            } else {
                distanceInKm = distance; // Already in km
            }
            
            // Convert to metric if using imperial system
            const distanceInMetric = globalUnit === 'imperial' ? distanceInKm * 1.60934 : distanceInKm;
            
            // Calculate pace - always in min/km (or min/mile for imperial)
            const pacePerKm = totalSeconds / distanceInKm;
            const pacePerUnit = globalUnit === 'metric' ? pacePerKm : pacePerKm * 1.60934;
            
            // Calculate speed
            const speed = (distanceInKm / (totalSeconds / 3600) * (globalUnit === 'metric' ? 1 : 0.621371)).toFixed(2);
            
            // Display units
            const distanceUnit = paceUnitInput === 'meter' ? 'm' : (globalUnit === 'metric' ? 'km' : 'miles');
            const paceUnit = globalUnit === 'metric' ? 'min/km' : 'min/mile';
            const speedUnit = globalUnit === 'metric' ? 'km/h' : 'mph';
            
            // Format pace display - always in min/km or min/mile
            const paceDisplay = `${formatTime(pacePerUnit, false)} ${paceUnit}`;
            
            let results = `
                <div class="result-grid">
                    <div class="result-item"><div class="result-label">Distance</div><div class="result-value">${distance} ${distanceUnit}</div></div>
                    <div class="result-item"><div class="result-label">Total Time</div><div class="result-value">${formatTime(totalSeconds, true)}</div></div>
                    <div class="result-item"><div class="result-label">Pace</div><div class="result-value">${paceDisplay}</div></div>
                    <div class="result-item"><div class="result-label">Speed</div><div class="result-value">${speed} ${speedUnit}</div></div>
                </div>
            `;
            
            showResults('paceResults', results);
        }
        
        // Race Predictor
        function calculateRacePredictor() {
            const recentDistance = parseFloat(document.getElementById('recentRaceDistance').value);
            const targetDistance = parseFloat(document.getElementById('targetRaceDistance').value);
            const hours = parseInt(document.getElementById('recentRaceHours').value) || 0;
            const minutes = parseInt(document.getElementById('recentRaceMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('recentRaceSeconds').value) || 0;
            
            if (!recentDistance || !targetDistance) {
                showError('racePredictorError', 'Please enter valid distances.');
                return;
            }
            
            const totalSeconds = timeToSeconds(hours, minutes, seconds);
            if (totalSeconds === 0) {
                showError('racePredictorError', 'Please enter a valid race time.');
                return;
            }
            
            const recentDistanceMetric = convertDistanceToMetric(recentDistance);
            const targetDistanceMetric = convertDistanceToMetric(targetDistance);
            
            // Riegel's Formula
            const predictedSeconds = totalSeconds * Math.pow(targetDistanceMetric / recentDistanceMetric, 1.06);
            const predictedPace = predictedSeconds / targetDistanceMetric;
            const currentPace = totalSeconds / recentDistanceMetric;
            
            const distanceUnit = globalUnit === 'metric' ? 'km' : 'miles';
            const paceUnit = globalUnit === 'metric' ? 'min/km' : 'min/mile';
            const adjustedPredictedPace = globalUnit === 'metric' ? predictedPace : predictedPace * 1.60934;
            const adjustedCurrentPace = globalUnit === 'metric' ? currentPace : currentPace * 1.60934;
            
            let results = `
                <div class="result-grid">
                    <div class="result-item"><div class="result-label">Recent Race</div><div class="result-value">${recentDistance} ${distanceUnit} in ${formatTime(totalSeconds, true)}</div></div>
                    <div class="result-item"><div class="result-label">Recent Pace</div><div class="result-value">${formatTime(adjustedCurrentPace, false)} ${paceUnit}</div></div>
                    <div class="result-item"><div class="result-label">Predicted Time</div><div class="result-value">${formatTime(predictedSeconds, true)}</div></div>
                    <div class="result-item"><div class="result-label">Predicted Pace</div><div class="result-value">${formatTime(adjustedPredictedPace, false)} ${paceUnit}</div></div>
                </div>
            `;
            
            showResults('racePredictorResults', results);
        }
        
        // Race Time Improvement Calculator
        function calculateImprovement() {
            const distance = parseFloat(document.getElementById('improvementDistance').value);
            const currentHours = parseInt(document.getElementById('currentBestHours').value) || 0;
            const currentMinutes = parseInt(document.getElementById('currentBestMinutes').value) || 0;
            const currentSeconds = parseInt(document.getElementById('currentBestSeconds').value) || 0;
            const targetHours = parseInt(document.getElementById('targetTimeHours').value) || 0;
            const targetMinutes = parseInt(document.getElementById('targetTimeMinutes').value) || 0;
            const targetSeconds = parseInt(document.getElementById('targetTimeSeconds').value) || 0;
            
            if (!distance) {
                showError('improvementError', 'Please enter a valid distance.');
                return;
            }
            
            const currentTime = timeToSeconds(currentHours, currentMinutes, currentSeconds);
            const targetTime = timeToSeconds(targetHours, targetMinutes, targetSeconds);
            
            if (currentTime === 0 || targetTime === 0) {
                showError('improvementError', 'Please enter valid times.');
                return;
            }
            
            const distanceMetric = convertDistanceToMetric(distance);
            const currentPace = currentTime / distanceMetric;
            const targetPace = targetTime / distanceMetric;
            const improvement = currentTime - targetTime;
            const paceImprovement = currentPace - targetPace;
            const percentImprovement = ((currentTime - targetTime) / currentTime * 100).toFixed(2);
            
            const distanceUnit = globalUnit === 'metric' ? 'km' : 'miles';
            const paceUnit = globalUnit === 'metric' ? 'min/km' : 'min/mile';
            const adjustedCurrentPace = globalUnit === 'metric' ? currentPace : currentPace * 1.60934;
            const adjustedTargetPace = globalUnit === 'metric' ? targetPace : targetPace * 1.60934;
            const adjustedPaceImprovement = globalUnit === 'metric' ? paceImprovement : paceImprovement * 1.60934;
            
            let results = `
                <div class="result-grid">
                    <div class="result-item"><div class="result-label">Current Best</div><div class="result-value">${formatTime(currentTime, true)} (${formatTime(adjustedCurrentPace, false)} ${paceUnit})</div></div>
                    <div class="result-item"><div class="result-label">Target Time</div><div class="result-value">${formatTime(targetTime, true)} (${formatTime(adjustedTargetPace, false)} ${paceUnit})</div></div>
                    <div class="result-item"><div class="result-label">Time Improvement</div><div class="result-value">${formatTime(improvement, true)} (${percentImprovement}%)</div></div>
                    <div class="result-item"><div class="result-label">Pace Improvement</div><div class="result-value">${formatTime(adjustedPaceImprovement, false)} ${paceUnit}</div></div>
                </div>
            `;
            
            showResults('improvementResults', results);
        }
        
        // Split Strategy Functions
        function updateSplitStrategy() {
            const strategy = document.getElementById('splitStrategy').value;
            const percentageGroup = document.getElementById('splitPercentageGroup');
            
            if (strategy === 'even') {
                percentageGroup.style.display = 'none';
            } else {
                percentageGroup.style.display = 'block';
            }
        }
        
        function updateSplitPercentageValue() {
            const slider = document.getElementById('splitPercentage');
            const valueDisplay = document.getElementById('splitPercentageValue');
            valueDisplay.textContent = parseFloat(slider.value).toFixed(1) + '%';
        }
        
        function updateSplitDistance() {
            const select = document.getElementById('splitDistanceSelect');
            const input = document.getElementById('splitDistance');
            
            if (select.value === 'custom') {
                input.disabled = false;
                input.placeholder = 'e.g., 21.1';
                input.value = '';
            } else {
                input.disabled = true;
                input.value = select.value;
                input.placeholder = select.options[select.selectedIndex].text;
            }
        }
        
        function updateRecentRaceDistance() {
            const select = document.getElementById('recentRaceDistanceSelect');
            const input = document.getElementById('recentRaceDistance');
            
            if (select.value === 'custom') {
                input.disabled = false;
                input.placeholder = 'e.g., 10';
                input.value = '';
            } else {
                input.disabled = true;
                input.value = select.value;
                input.placeholder = select.options[select.selectedIndex].text;
            }
        }
        
        function updateTargetRaceDistance() {
            const select = document.getElementById('targetRaceDistanceSelect');
            const input = document.getElementById('targetRaceDistance');
            
            if (select.value === 'custom') {
                input.disabled = false;
                input.placeholder = 'e.g., 21.1';
                input.value = '';
            } else {
                input.disabled = true;
                input.value = select.value;
                input.placeholder = select.options[select.selectedIndex].text;
            }
        }
        
        // Running Split Calculator
        function calculateSplits() {
            const distance = parseFloat(document.getElementById('splitDistance').value);
            const interval = parseFloat(document.getElementById('splitInterval').value);
            const hours = parseInt(document.getElementById('splitHours').value) || 0;
            const minutes = parseInt(document.getElementById('splitMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('splitSeconds').value) || 0;
            const strategy = document.getElementById('splitStrategy').value;
            const percentage = parseFloat(document.getElementById('splitPercentage').value) || 0;
            
            if (!distance || !interval) {
                showError('splitError', 'Please enter valid distance and interval.');
                return;
            }
            
            const totalSeconds = timeToSeconds(hours, minutes, seconds);
            if (totalSeconds === 0) {
                showError('splitError', 'Please enter a valid total time.');
                return;
            }
            
            const distanceMetric = convertDistanceToMetric(distance);
            const intervalMetric = convertDistanceToMetric(interval);
            const numberOfSplits = Math.floor(distanceMetric / intervalMetric);
            const remainingDistance = distanceMetric % intervalMetric;
            
            const basePace = totalSeconds / distanceMetric;
            const distanceUnit = globalUnit === 'metric' ? 'km' : 'miles';
            
            let results = '<div class="split-results">';
            let cumulativeTime = 0;
            
            // Calculate split times based on strategy
            for (let i = 1; i <= numberOfSplits; i++) {
                let splitPace = basePace;
                
                if (strategy === 'negative') {
                    // Negative splits: start slower, get faster
                    // Apply percentage change per split (slower at start, faster at end)
                    const progress = (i - 1) / (numberOfSplits - 1); // 0 to 1
                    const paceAdjustment = 1 + (percentage / 100) * (1 - progress);
                    splitPace = basePace * paceAdjustment;
                } else if (strategy === 'positive') {
                    // Positive splits: start faster, get slower
                    // Apply percentage change per split (faster at start, slower at end)
                    const progress = (i - 1) / (numberOfSplits - 1); // 0 to 1
                    const paceAdjustment = 1 - (percentage / 100) * (1 - progress);
                    splitPace = basePace * paceAdjustment;
                }
                
                const splitTime = splitPace * intervalMetric;
                cumulativeTime += splitTime;
                const splitDistance = interval * i;
                
                // Calculate pace per km for display
                const displayPace = globalUnit === 'metric' ? splitPace : splitPace * 1.60934;
                const paceUnit = globalUnit === 'metric' ? 'min/km' : 'min/mile';
                
                results += `
                    <div class="split-item">
                        <strong>${splitDistance} ${distanceUnit}</strong><br>
                        Split: ${formatTime(splitTime, false)}<br>
                        Pace: ${formatTime(displayPace, false)} ${paceUnit}<br>
                        Total: ${formatTime(cumulativeTime, true)}
                    </div>
                `;
            }
            
            if (remainingDistance > 0.01) {
                let finalSplitPace = basePace;
                
                if (strategy === 'negative') {
                    // For final split, use the fastest pace
                    finalSplitPace = basePace * (1 - percentage / 100);
                } else if (strategy === 'positive') {
                    // For final split, use the slowest pace
                    finalSplitPace = basePace * (1 + percentage / 100);
                }
                
                const finalSplitTime = finalSplitPace * remainingDistance;
                cumulativeTime += finalSplitTime;
                const finalDistance = convertDistanceFromMetric(distanceMetric);
                const displayPace = globalUnit === 'metric' ? finalSplitPace : finalSplitPace * 1.60934;
                const paceUnit = globalUnit === 'metric' ? 'min/km' : 'min/mile';
                
                results += `
                    <div class="split-item">
                        <strong>${finalDistance.toFixed(2)} ${distanceUnit}</strong><br>
                        Split: ${formatTime(finalSplitTime, false)}<br>
                        Pace: ${formatTime(displayPace, false)} ${paceUnit}<br>
                        Total: ${formatTime(cumulativeTime, true)}
                    </div>
                `;
            }
            
            // Add strategy summary
            const strategyText = strategy === 'even' ? 'Even Splits (Konsisten)' : 
                                strategy === 'negative' ? `Negative Splits (${percentage}% perubahan per split)` :
                                `Positive Splits (${percentage}% perubahan per split)`;
            
            results = `<div class="info-note" style="margin-bottom: 1rem;">
                <strong>Strategy:</strong> ${strategyText}
            </div>` + results;
            
            results += '</div>';
            
            showResults('splitResults', results);
        }
        
        // Steps to Distance Calculator
        function calculateStepsToDistance() {
            const steps = parseInt(document.getElementById('stepsCount').value);
            const strideLength = parseFloat(document.getElementById('strideLength').value);
            
            if (!steps || !strideLength) {
                showError('stepsError', 'Please enter valid steps and stride length.');
                return;
            }
            
            let distanceMeters;
            if (globalUnit === 'metric') {
                distanceMeters = (steps * strideLength) / 100; // cm to m
            } else {
                distanceMeters = (steps * strideLength * 2.54) / 100; // inches to cm to m
            }
            
            const distanceKm = distanceMeters / 1000;
            const distanceMiles = distanceKm * 0.621371;
            const displayDistance = globalUnit === 'metric' ? distanceKm : distanceMiles;
            const distanceUnit = globalUnit === 'metric' ? 'km' : 'miles';
            const strideLengthUnit = globalUnit === 'metric' ? 'cm' : 'inches';
            
            let results = `
                <div class="result-grid">
                    <div class="result-item"><div class="result-label">Steps</div><div class="result-value">${steps.toLocaleString()}</div></div>
                    <div class="result-item"><div class="result-label">Stride Length</div><div class="result-value">${strideLength} ${strideLengthUnit}</div></div>
                    <div class="result-item"><div class="result-label">Distance</div><div class="result-value">${displayDistance.toFixed(2)} ${distanceUnit}</div></div>
                    <div class="result-item"><div class="result-label">Distance (meters)</div><div class="result-value">${distanceMeters.toFixed(0)} m</div></div>
                </div>
            `;
            
            showResults('stepsResults', results);
        }
        
        // Stride Length Calculator
        function calculateStrideLength() {
            const distance = parseFloat(document.getElementById('strideDistance').value);
            const steps = parseInt(document.getElementById('strideStepsCount').value);
            
            if (!distance || !steps) {
                showError('strideLengthError', 'Please enter valid distance and steps.');
                return;
            }
            
            const distanceMetric = convertDistanceToMetric(distance);
            const distanceMeters = distanceMetric * 1000;
            const strideLengthCm = (distanceMeters / steps) * 100;
            const strideLengthInches = strideLengthCm / 2.54;
            
            const displayStrideLength = globalUnit === 'metric' ? strideLengthCm : strideLengthInches;
            const strideLengthUnit = globalUnit === 'metric' ? 'cm' : 'inches';
            const distanceUnit = globalUnit === 'metric' ? 'km' : 'miles';
            
            let results = `
                <div class="result-grid">
                    <div class="result-item"><div class="result-label">Distance</div><div class="result-value">${distance} ${distanceUnit}</div></div>
                    <div class="result-item"><div class="result-label">Steps</div><div class="result-value">${steps.toLocaleString()}</div></div>
                    <div class="result-item"><div class="result-label">Stride Length</div><div class="result-value">${displayStrideLength.toFixed(1)} ${strideLengthUnit}</div></div>
                    <div class="result-item"><div class="result-label">Stride Length (cm)</div><div class="result-value">${strideLengthCm.toFixed(1)} cm</div></div>
                </div>
            `;
            
            showResults('strideLengthResults', results);
        }
		// Helper: Calculate VDOT from race distance (km) and time (seconds)
		function calculateVDOT(distKm, timeSec) {
			const timeMin = timeSec / 60;
			const velocity = (distKm * 1000 / timeSec) * 60; // m/min
			let vo2 = -4.60 + 0.182258 * velocity + 0.000104 * Math.pow(velocity, 2);
			const percentMax = 0.8 + 0.1894393 * Math.exp(-0.012778 * timeMin) + 0.2989558 * Math.exp(-0.1932605 * timeMin);
			return vo2 / percentMax;
		}
		
		// Helper: Get pace (seconds per unit distance) from VDOT and %VDOT
		function getPaceFromVDOT(vdot, percent, globalUnit) {
			const vo2Target = percent * vdot;
			const a = 0.000104;
			const b = 0.182258;
			const c = -(vo2Target + 4.6);
			const discriminant = Math.pow(b, 2) - 4 * a * c;
			if (discriminant < 0) return null;
			const v = (-b + Math.sqrt(discriminant)) / (2 * a); // m/min, positive root
			const secPerKm = (1000 / v) * 60; // seconds per km
			return globalUnit === 'metric' ? secPerKm : secPerKm * 1.60934; // sec per mile if imperial
		}
		function setDefaultDistance() {
			const basePaceType = document.getElementById('basePaceType').value;
			const distanceInput = document.getElementById('trainingDistance');
			const distances = {
				'5k': 5,
				'10k': 10,
				'half': 21.1,
				'marathon': 42.2,
				'threshold': 10  // Example: 10km threshold run
			};
			distanceInput.value = distances[basePaceType] || 5;
		}
        
		// Get Current Weather Function
		async function getCurrentWeather() {
			const weatherBtn = document.getElementById('getWeatherBtn');
			const originalText = weatherBtn.innerHTML;
			
			// Show loading state
			weatherBtn.innerHTML = 'üîÑ Mendeteksi...';
			weatherBtn.disabled = true;
			
			try {
				// Get user's location
				const position = await getCurrentPosition();
				const { latitude, longitude } = position.coords;
				
				// Get weather data from OpenWeatherMap API (free tier)
				const apiKey = 'demo'; // In production, use a real API key
				const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${apiKey}&units=metric`;
				
				// For demo purposes, we'll use a fallback since we don't have a real API key
				// In production, replace this with actual API call
				const weatherData = await getWeatherDataFallback();
				
				// Update form fields
				const tempInput = document.getElementById('hrTemperature');
				const humidityInput = document.getElementById('hrHumidity');
				
				if (tempInput) tempInput.value = Math.round(weatherData.temperature);
				if (humidityInput) humidityInput.value = Math.round(weatherData.humidity);
				
				// Show success message
				weatherBtn.innerHTML = '‚úÖ Berhasil!';
				setTimeout(() => {
					weatherBtn.innerHTML = originalText;
					weatherBtn.disabled = false;
				}, 2000);
				
			} catch (error) {
				console.error('Weather detection error:', error);
				
				// Show error and fallback to default values
				weatherBtn.innerHTML = '‚ùå Gagal, gunakan default';
				setTimeout(() => {
					weatherBtn.innerHTML = originalText;
					weatherBtn.disabled = false;
				}, 2000);
			}
		}
		
		// Get current position with promise
		function getCurrentPosition() {
			return new Promise((resolve, reject) => {
				if (!navigator.geolocation) {
					reject(new Error('Geolocation tidak didukung'));
					return;
				}
				
				navigator.geolocation.getCurrentPosition(resolve, reject, {
					timeout: 10000,
					enableHighAccuracy: true
				});
			});
		}
		
		// Fallback weather data (simulated)
		async function getWeatherDataFallback() {
			// Simulate API delay
			await new Promise(resolve => setTimeout(resolve, 1000));
			
			// Return simulated weather data based on time of day and season
			const now = new Date();
			const hour = now.getHours();
			const month = now.getMonth();
			
			// Simulate temperature based on time and season
			let baseTemp = 25;
			if (month >= 11 || month <= 2) baseTemp = 22; // Winter
			else if (month >= 3 && month <= 5) baseTemp = 28; // Spring
			else if (month >= 6 && month <= 8) baseTemp = 30; // Summer
			else baseTemp = 26; // Fall
			
			// Adjust for time of day
			if (hour >= 6 && hour <= 10) baseTemp += 2; // Morning
			else if (hour >= 11 && hour <= 15) baseTemp += 5; // Afternoon
			else if (hour >= 16 && hour <= 18) baseTemp += 3; // Evening
			else baseTemp -= 2; // Night
			
			// Add some randomness
			const tempVariation = (Math.random() - 0.5) * 4;
			const temperature = Math.max(15, Math.min(40, baseTemp + tempVariation));
			
			// Simulate humidity
			const humidity = Math.round(50 + Math.random() * 30); // 50-80%
			
			return {
				temperature: temperature,
				humidity: humidity
			};
		}

		// Heart Rate Zone Calculator
		function calculateHeartRateZones() {
			const age = parseInt(document.getElementById('hrAge').value);
			const hrRestInput = document.getElementById('hrRest').value;
			const hrRest = hrRestInput ? parseInt(hrRestInput) : null;
			const gender = document.getElementById('hrGender').value;
			const fitness = document.getElementById('hrFitness').value;
			const intensity = document.getElementById('hrIntensity').value;
			const duration = parseInt(document.getElementById('hrDuration').value) || 30;
			const temperature = parseInt(document.getElementById('hrTemperature').value) || 25;
			const humidity = parseInt(document.getElementById('hrHumidity').value) || 60;
			
			if (!age) {
				showError('heartRateError', 'Usia wajib diisi.');
				return;
			}
			
			if (age < 10 || age > 100) {
				showError('heartRateError', 'Usia harus antara 10-100 tahun.');
				return;
			}
			
			// Estimate HRrest if not provided
			let estimatedHrRest = hrRest;
			let isEstimated = false;
			
			if (!hrRest) {
				// Estimate based on age, gender, and fitness level
				let baseHrRest = 70; // Average resting heart rate
				
				// Age adjustment (older = slightly higher)
				if (age > 50) baseHrRest += 2;
				else if (age > 30) baseHrRest += 1;
				
				// Gender adjustment (females typically 2-3 bpm higher)
				if (gender === 'female') baseHrRest += 2;
				
				// Fitness level adjustment
				const fitnessAdjustments = {
					'beginner': 3,      // Less fit = higher resting HR
					'intermediate': 0,  // Average
					'advanced': -3,     // More fit = lower resting HR
					'athlete': -5       // Athletes have very low resting HR
				};
				baseHrRest += fitnessAdjustments[fitness];
				
				// Add some randomness (¬±2 bpm)
				const randomVariation = (Math.random() - 0.5) * 4;
				estimatedHrRest = Math.round(Math.max(45, Math.min(85, baseHrRest + randomVariation)));
				isEstimated = true;
			} else if (hrRest < 30 || hrRest > 120) {
				showError('heartRateError', 'Detak jantung istirahat harus antara 30-120 bpm.');
				return;
			}
			
			// Calculate HRmax using different formulas
			const hrmaxTanaka = 208 - (0.7 * age); // Tanaka formula (more accurate for older adults)
			const hrmaxFox = 220 - age; // Traditional Fox formula
			const hrmaxGellish = 206.9 - (0.67 * age); // Gellish formula
			
			// Use the most appropriate formula based on age and gender
			let hrmax;
			if (age < 40) {
				hrmax = hrmaxFox; // Fox formula for younger adults
			} else if (age < 60) {
				hrmax = hrmaxTanaka; // Tanaka formula for middle-aged
			} else {
				hrmax = hrmaxGellish; // Gellish formula for older adults
			}
			
			// Gender adjustment (small difference)
			if (gender === 'female') {
				hrmax -= 2; // Slight reduction for females
			}
			
			// Fitness level adjustment
			const fitnessAdjustments = {
				'beginner': 0,
				'intermediate': 2,
				'advanced': 4,
				'athlete': 6
			};
			hrmax += fitnessAdjustments[fitness];
			
			// Environmental factors adjustment
			let envAdjustment = 0;
			if (temperature > 30) {
				envAdjustment += Math.floor((temperature - 30) / 5) * 2; // +2 bpm per 5¬∞C above 30¬∞C
			}
			if (humidity > 70) {
				envAdjustment += Math.floor((humidity - 70) / 10) * 1; // +1 bpm per 10% above 70%
			}
			
			// Duration adjustment (longer duration = slightly higher HR)
			let durationAdjustment = 0;
			if (duration > 60) {
				durationAdjustment = Math.floor((duration - 60) / 30) * 1; // +1 bpm per 30 min above 60 min
			}
			
			// Apply adjustments
			hrmax += envAdjustment + durationAdjustment;
			
			// Calculate Heart Rate Reserve (HRR) using Karvonen formula
			const hrr = hrmax - estimatedHrRest;
			
			// Define heart rate zones based on Karvonen formula
			const zones = [
				{
					name: 'Zone 1 - Recovery',
					percentage: '50-60%',
					minPercent: 0.50,
					maxPercent: 0.60,
					description: 'Pemulihan aktif, pemanasan, pendinginan'
				},
				{
					name: 'Zone 2 - Easy',
					percentage: '60-70%',
					minPercent: 0.60,
					maxPercent: 0.70,
					description: 'Latihan dasar, pembakaran lemak, endurance'
				},
				{
					name: 'Zone 3 - Moderate',
					percentage: '70-80%',
					minPercent: 0.70,
					maxPercent: 0.80,
					description: 'Latihan aerobik, peningkatan kapasitas paru-paru'
				},
				{
					name: 'Zone 4 - Tempo',
					percentage: '80-90%',
					minPercent: 0.80,
					maxPercent: 0.90,
					description: 'Threshold, latihan intensitas tinggi'
				},
				{
					name: 'Zone 5 - Interval',
					percentage: '90-100%',
					minPercent: 0.90,
					maxPercent: 1.00,
					description: 'VO2 Max, latihan kecepatan maksimal'
				}
			];
			
			// Calculate HR ranges for each zone
			zones.forEach(zone => {
				zone.minHR = Math.round(estimatedHrRest + (zone.minPercent * hrr));
				zone.maxHR = Math.round(estimatedHrRest + (zone.maxPercent * hrr));
				zone.range = `${zone.minHR}-${zone.maxHR} bpm`;
			});
			
			// Get recommended zone based on selected intensity
			const intensityZones = {
				'recovery': zones[0],
				'easy': zones[1],
				'moderate': zones[2],
				'tempo': zones[3],
				'interval': zones[4],
				'repetition': zones[4] // Same as interval for max intensity
			};
			
			const recommendedZone = intensityZones[intensity];
			
			// Create results HTML
			let results = `
				<div class="hr-summary">
					<h3>üìä Ringkasan Heart Rate Zones</h3>
					<div class="hr-summary-grid">
						<div class="hr-summary-item">
							<span class="hr-summary-label">Usia:</span>
							<span class="hr-summary-value">${age} tahun</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">HR Rest:</span>
							<span class="hr-summary-value">${estimatedHrRest} bpm${isEstimated ? ' (diestimasi)' : ''}</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">HR Max:</span>
							<span class="hr-summary-value">${Math.round(hrmax)} bpm</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">HR Reserve:</span>
							<span class="hr-summary-value">${Math.round(hrr)} bpm</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">Jenis Kelamin:</span>
							<span class="hr-summary-value">${gender === 'male' ? 'Laki-laki' : 'Perempuan'}</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">Tingkat Kebugaran:</span>
							<span class="hr-summary-value">${fitness.charAt(0).toUpperCase() + fitness.slice(1)}</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">Suhu Lingkungan:</span>
							<span class="hr-summary-value">${temperature}¬∞C</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">Kelembaban:</span>
							<span class="hr-summary-value">${humidity}%</span>
						</div>
					</div>
				</div>
				
				<div class="hr-summary">
					<h3>üéØ Zona Rekomendasi untuk ${intensity.charAt(0).toUpperCase() + intensity.slice(1)}</h3>
					<div class="hr-summary-grid">
						<div class="hr-summary-item">
							<span class="hr-summary-label">Zona:</span>
							<span class="hr-summary-value">${recommendedZone.name}</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">Range HR:</span>
							<span class="hr-summary-value">${recommendedZone.range}</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">Persentase:</span>
							<span class="hr-summary-value">${recommendedZone.percentage}</span>
						</div>
						<div class="hr-summary-item">
							<span class="hr-summary-label">Durasi:</span>
							<span class="hr-summary-value">${duration} menit</span>
						</div>
					</div>
					<p style="margin-top: 1rem; color: var(--gray-600); font-size: 0.875rem;">
						<strong>Deskripsi:</strong> ${recommendedZone.description}
					</p>
					${isEstimated ? '<p style="margin-top: 0.5rem; color: var(--warning); font-size: 0.75rem; font-style: italic;">‚ö†Ô∏è HR Rest diestimasi berdasarkan usia, jenis kelamin, dan tingkat kebugaran. Untuk hasil yang lebih akurat, ukur HR Rest Anda saat bangun pagi.</p>' : ''}
				</div>
				
				<table class="hr-table" id="heartRateTable">
					<thead>
						<tr>
							<th>Zona</th>
							<th>Persentase HRR</th>
							<th>Range HR (bpm)</th>
							<th>Deskripsi</th>
						</tr>
					</thead>
					<tbody>
			`;
			
			zones.forEach(zone => {
				const isRecommended = zone === recommendedZone;
				results += `
					<tr ${isRecommended ? 'style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);"' : ''}>
						<td class="hr-zone" data-label="Zona">${zone.name}</td>
						<td class="hr-percentage" data-label="Persentase HRR">${zone.percentage}</td>
						<td class="hr-range" data-label="Range HR (bpm)">${zone.range}</td>
						<td class="hr-description" data-label="Deskripsi">${zone.description}</td>
					</tr>
				`;
			});
			
			results += `
					</tbody>
				</table>
				
				<button class="export-button" onclick="exportHeartRateTable()">
					üì∏ Ekspor Tabel ke Image
				</button>
			`;
			
			showResults('heartRateResults', results);
		}
		
		// Universal Export Function for All Calculators
		function exportResults(resultsId, calculatorName) {
			const resultsElement = document.getElementById(resultsId);
			if (!resultsElement || !resultsElement.classList.contains('show')) {
				alert('Tidak ada hasil untuk diekspor. Silakan hitung terlebih dahulu.');
				return;
			}
			
			// Create export container
			const exportContainer = document.createElement('div');
			exportContainer.className = 'export-container';
			
			// Add watermark
			const watermark = document.createElement('img');
			watermark.className = 'watermark';
			watermark.src = 'https://res.cloudinary.com/dslfarxct/images/v1761034847/logo-ruang-lari-scaled/logo-ruang-lari-scaled.png?_i=AA';
			watermark.alt = 'Ruang Lari';
			exportContainer.appendChild(watermark);
			
			// Add title
			const title = document.createElement('h2');
			title.textContent = `${calculatorName} - Ruang Lari Tools`;
			title.style.cssText = `
				color: #6366f1;
				margin-bottom: 1.5rem;
				text-align: center;
				font-size: 1.5rem;
				font-weight: 700;
			`;
			exportContainer.appendChild(title);
			
			// Clone the results content
			const resultsClone = resultsElement.cloneNode(true);
			resultsClone.style.cssText = `
				background: transparent;
				padding: 0;
				border: none;
				box-shadow: none;
				display: block;
			`;
			
			// Style the cloned content for export
			styleContentForExport(resultsClone);
			
			exportContainer.appendChild(resultsClone);
			
			// Add to body temporarily
			document.body.appendChild(exportContainer);
			
			// Use html2canvas to convert to image
			html2canvas(exportContainer, {
				backgroundColor: '#ffffff',
				scale: 2,
				useCORS: true,
				allowTaint: true,
				width: exportContainer.offsetWidth,
				height: exportContainer.offsetHeight
			}).then(canvas => {
				// Create download link
				const link = document.createElement('a');
				const fileName = calculatorName.toLowerCase().replace(/\s+/g, '-');
				link.download = `${fileName}-${new Date().toISOString().split('T')[0]}.png`;
				link.href = canvas.toDataURL();
				link.click();
				
				// Remove temporary container
				document.body.removeChild(exportContainer);
			}).catch(error => {
				console.error('Error exporting results:', error);
				alert('Gagal mengekspor hasil. Silakan coba lagi.');
				document.body.removeChild(exportContainer);
			});
		}
		
		// Style content for export
		function styleContentForExport(element) {
			// Style result grids
			const resultGrids = element.querySelectorAll('.result-grid');
			resultGrids.forEach(grid => {
				grid.style.cssText = `
					display: grid;
					gap: 1rem;
					margin: 0;
				`;
			});
			
			// Style result items
			const resultItems = element.querySelectorAll('.result-item');
			resultItems.forEach(item => {
				item.style.cssText = `
					display: flex;
					justify-content: space-between;
					align-items: center;
					padding: 1rem;
					background: #f9fafb;
					border-radius: 0.75rem;
					box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
					border: 1px solid #e5e7eb;
				`;
			});
			
			// Style split results
			const splitResults = element.querySelectorAll('.split-results');
			splitResults.forEach(split => {
				split.style.cssText = `
					display: grid;
					grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
					gap: 1rem;
					margin: 1.5rem 0 0 0;
				`;
			});
			
			// Style split items
			const splitItems = element.querySelectorAll('.split-item');
			splitItems.forEach(item => {
				item.style.cssText = `
					background: white;
					padding: 1.25rem;
					border-radius: 0.75rem;
					box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
					border-left: 4px solid #06b6d4;
					border: 1px solid #e5e7eb;
				`;
			});
			
			// Style tables
			const tables = element.querySelectorAll('table');
			tables.forEach(table => {
				table.style.cssText = `
					width: 100%;
					border-collapse: collapse;
					margin: 1.5rem 0;
					background: white;
					border-radius: 0.75rem;
					overflow: hidden;
					box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
				`;
				
				// Style table cells
				const cells = table.querySelectorAll('th, td');
				cells.forEach(cell => {
					cell.style.cssText = `
						padding: 1rem;
						text-align: left;
						border-bottom: 1px solid #e5e7eb;
					`;
				});
				
				// Style table headers
				const headers = table.querySelectorAll('th');
				headers.forEach(header => {
					header.style.cssText = `
						background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
						color: white;
						font-weight: 600;
						font-size: 0.875rem;
						text-transform: uppercase;
						letter-spacing: 0.05em;
						padding: 1rem;
						text-align: left;
						border-bottom: 1px solid #e5e7eb;
					`;
				});
			});
			
			// Style summary boxes
			const summaries = element.querySelectorAll('.hr-summary');
			summaries.forEach(summary => {
				summary.style.cssText = `
					background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
					padding: 1.5rem;
					border-radius: 0.75rem;
					margin-bottom: 1.5rem;
					border-left: 4px solid #06b6d4;
				`;
			});
		}
		
		// Legacy function for heart rate table (kept for compatibility)
		function exportHeartRateTable() {
			exportResults('heartRateResults', 'Heart Rate Zones Calculator');
		}

		// Updated Training Pace Calculator
		function calculateTrainingPaces() {
			const basePaceType = document.getElementById('basePaceType').value;
			const distance = parseFloat(document.getElementById('trainingDistance').value) || 0;
			const bestHours = parseInt(document.getElementById('bestTimeHours').value) || 0;
			const bestMinutes = parseInt(document.getElementById('bestTimeMinutes').value) || 0;
			const bestSeconds = parseInt(document.getElementById('bestTimeSeconds').value) || 0;
			const manualHours = parseInt(document.getElementById('basePaceHours').value) || 0;
			const manualMinutes = parseInt(document.getElementById('basePaceMinutes').value) || 0;
			const manualSeconds = parseInt(document.getElementById('basePaceSeconds').value) || 0;
			
			let basePaceSeconds = timeToSeconds(manualHours, manualMinutes, manualSeconds);
			let effectiveBasePaceSecPerKm;
			let basePaceDescription = 'Manual Base Pace';
			
			if (distance > 0) {
				const bestTimeSec = timeToSeconds(bestHours, bestMinutes, bestSeconds);
				if (bestTimeSec > 0) {
					// Compute base pace from best time + distance
					const distanceMetric = convertDistanceToMetric(distance);
					effectiveBasePaceSecPerKm = bestTimeSec / distanceMetric;  // sec per km
					basePaceSeconds = globalUnit === 'metric' ? effectiveBasePaceSecPerKm : effectiveBasePaceSecPerKm * 1.60934;  // Adjust for display
					basePaceDescription = `Computed from ${formatTime(bestTimeSec, true)} over ${distance} ${globalUnit === 'metric' ? 'km' : 'miles'}`;
				} else if (basePaceSeconds === 0) {
					showError('trainingPaceError', 'Please enter best race time or manual base pace.');
					return;
				}
			} else if (basePaceSeconds === 0) {
				showError('trainingPaceError', 'Please enter a valid distance and best time, or manual base pace.');
				return;
			}
			
			if (basePaceSeconds === 0) {
				showError('trainingPaceError', 'Please enter a valid base pace.');
				return;
			}
			
			// Normalize to seconds per km for VDOT
			let pacePerKmSeconds;
			if (globalUnit === 'metric') {
				pacePerKmSeconds = basePaceSeconds;
			} else {
				pacePerKmSeconds = basePaceSeconds / 1.60934;  // miles to km
			}
			
			// Race distances in km (for non-threshold VDOT calc)
			const raceDistances = {
				'5k': 5,
				'10k': 10,
				'half': 21.0975,
				'marathon': 42.195
			};
			
			let vdot;
			let useDistanceForVDOT = distance > 0 ? distance : (basePaceType !== 'threshold' ? raceDistances[basePaceType] : 10);
			const useDistMetric = convertDistanceToMetric(useDistanceForVDOT);
			const totalTimeSec = useDistMetric * pacePerKmSeconds;
			
			if (basePaceType === 'threshold') {
				// Assume 60-min threshold effort for VDOT
				const timeMin = 60;
				const percentMax = 0.8 + 0.1894393 * Math.exp(-0.012778 * timeMin) + 0.2989558 * Math.exp(-0.1932605 * timeMin);
				const velocityMPerMin = (1000 * 60) / pacePerKmSeconds;
				const vo2 = -4.6 + 0.182258 * velocityMPerMin + 0.000104 * Math.pow(velocityMPerMin, 2);
				vdot = vo2 / percentMax;
			} else {
				vdot = calculateVDOT(useDistMetric, totalTimeSec);
			}
			
			// Training pace percentages (% of VDOT) - Jack Daniels' Running Formula
			const trainingPercents = {
				'easy': 0.65,        // Easy pace: 65% VDOT (recovery/easy runs)
				'moderate': 0.75,    // Moderate pace: 75% VDOT (long runs)
				'tempo': 0.85,       // Tempo pace: 85% VDOT (threshold)
				'interval': 0.95,    // Interval pace: 95% VDOT (VO2 max)
				'repetition': 1.00   // Repetition pace: 100% VDOT (speed work)
			};
			
			const paceUnit = globalUnit === 'metric' ? 'min/km' : 'min/mile';
			
			let results = '<div class="result-grid">';
			results += `<div class="result-item"><div class="result-label">Estimated VDOT</div><div class="result-value">${vdot.toFixed(1)}</div></div>`;
			results += `<div class="result-item"><div class="result-label">Base ${basePaceType.toUpperCase()} Pace</div><div class="result-value">${formatTime(basePaceSeconds, false)} ${paceUnit} (${basePaceDescription})</div></div>`;
			
			Object.entries(trainingPercents).forEach(([paceType, percent]) => {
				const trainingPaceSec = getPaceFromVDOT(vdot, percent, globalUnit);
				if (trainingPaceSec) {
					const paceTypeName = paceType.charAt(0).toUpperCase() + paceType.slice(1);
					let description = '';
					
					switch(paceType) {
						case 'easy':
							description = ' (Recovery/Easy runs)';
							break;
						case 'moderate':
							description = ' (Long runs)';
							break;
						case 'tempo':
							description = ' (Threshold runs)';
							break;
						case 'interval':
							description = ' (VO2 Max intervals)';
							break;
						case 'repetition':
							description = ' (Speed work)';
							break;
					}
					
					results += `<div class="result-item"><div class="result-label">${paceTypeName} Pace${description}</div><div class="result-value">${formatTime(trainingPaceSec, false)} ${paceUnit} (${(percent * 100).toFixed(0)}% VDOT)</div></div>`;
				}
			});
			
			results += '</div>';
			showResults('trainingPaceResults', results);
		}

		// Initialize: Set default on load
		document.addEventListener('DOMContentLoaded', function() {
			setDefaultDistance();
			updateAllLabels();
			updateSplitPercentageValue(); // Initialize slider value display
			updateSplitDistance(); // Initialize distance dropdown
			updateRecentRaceDistance(); // Initialize recent race distance dropdown
			updateTargetRaceDistance(); // Initialize target race distance dropdown
			updatePaceDistanceLabel(); // Initialize pace distance label
			
			// Check for hash in URL and open corresponding tab
			const hash = window.location.hash.substring(1); // Remove # symbol
			if (hash) {
				openTabByHash(hash);
			}
		});
		
		// Listen for hash changes
		window.addEventListener('hashchange', function() {
			const hash = window.location.hash.substring(1);
			if (hash) {
				openTabByHash(hash);
			}
		});
    </script>
</body>
</html>